<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Real Time Todolist</title>
</head>
<body>
    <h1>Todolist</h1>

    <form id="form" action="" method="">
        <input id="task" type="text" name="task" placeholder="Tasks">
        <input type="submit" value="Add">
    </form>

    <section>
        <ul id="todo"></ul>
    </section>
    <section>
        <ul id="done"></ul>
    </section>

    <script src="/socket.io/socket.io.js"></script>
    <script type="text/javascript">
        const socket = io();
        
        let form = document.getElementById('form');
        let inputTask = document.getElementById('task');
        let todo = document.getElementById('todo');
        let done = document.getElementById('done');
        let todolist = [];

        form.addEventListener('submit', function(e) {
            e.preventDefault();
            let inputValue = inputTask.value;

            let data = {
                task : inputValue
            }

            // console.log(inputValue);
            socket.emit('new_task', data);

            if (todolist.length == 0) {
                todo.innerHTML = '';
            }

            todolist.push(inputTask);
            todo.innerHTML += '<li id="'+(todolist.length-1)+'"><span></span></li>'
            let span = document.getElementsByTagName('span')[todolist.length-1];
            span.innerText = todolist[todolist.length-1];
            
            inputTask.focus();
            inputTask.value = '';
        })

        socket.on('todolist', (p_todolist) => {
            todolist = p_todolist;

            let todolistHtml = todolist.length > 0 ? "" : " Todolist empty ...";
            
            for (let i = 0; i < todolist.length; i++) {
                todolistHtml += '<li>'+ alltasks[i] +'</li>';
            }

            todo.innerHTML = todolistHtml;
        })

        socket.on('add_task', (tododata) => {
            if (todolist.length == 0) {
                todo.innerHTML = '';
            }

            todolist.push(todotata);
            todo.innerHTML += '<li id="'+(todolist.length-1)+'"><span>'+todolist[todolist.length-1]+'</span></li>';
        });

    </script>
</body>